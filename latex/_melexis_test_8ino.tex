\hypertarget{_melexis_test_8ino}{}\subsection{Melexis\+Test.\+ino File Reference}
\label{_melexis_test_8ino}\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}


Melexis M\+C\+X90614\+B\+AA Test Program -\/ Sensor test implementation. ~\newline
  


{\ttfamily \#include $<$Arduino.\+h$>$}\newline
{\ttfamily \#include $<$Wire.\+h$>$}\newline
{\ttfamily \#include $<$M\+L\+X90614.\+h$>$}\newline
{\ttfamily \#include \char`\"{}printf.\+h\char`\"{}}\newline
Include dependency graph for Melexis\+Test.\+ino\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_melexis_test_8ino__incl}
\end{center}
\end{figure}
\subsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structdefault_e_e_prom_data}{default\+E\+E\+Prom\+Data}}
\begin{DoxyCompactList}\small\item\em E\+E\+P\+R\+OM memory contents factory default values. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{_melexis_test_8ino_a7dfd9b79bc5a37d7df40207afbc5431f}\label{_melexis_test_8ino_a7dfd9b79bc5a37d7df40207afbc5431f}} 
void \mbox{\hyperlink{_melexis_test_8ino_a7dfd9b79bc5a37d7df40207afbc5431f}{setup}} (void)
\begin{DoxyCompactList}\small\item\em Program setup. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_melexis_test_8ino_a0b33edabd7f1c4e4a0bf32c67269be2f}\label{_melexis_test_8ino_a0b33edabd7f1c4e4a0bf32c67269be2f}} 
void \mbox{\hyperlink{_melexis_test_8ino_a0b33edabd7f1c4e4a0bf32c67269be2f}{loop}} (void)
\begin{DoxyCompactList}\small\item\em Main processing loop. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_melexis_test_8ino_a3906dd03c261bb9c83de87b9988e91ce}{println\+Temp}} (double temp, char src)
\begin{DoxyCompactList}\small\item\em Print a line of temperature, crc, pec, and error string. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_melexis_test_8ino_adf7e43c01edc71026fd6c122cf408817}\label{_melexis_test_8ino_adf7e43c01edc71026fd6c122cf408817}} 
void \mbox{\hyperlink{_melexis_test_8ino_adf7e43c01edc71026fd6c122cf408817}{dump\+E\+E\+Prom}} ()
\begin{DoxyCompactList}\small\item\em Print a complete memory dump of the E\+E\+P\+R\+OM. \end{DoxyCompactList}\item 
char $\ast$ \mbox{\hyperlink{_melexis_test_8ino_abbd67db9a56c14f56c98c750daf1ab92}{float\+To\+Str}} (char $\ast$str, double val)
\begin{DoxyCompactList}\small\item\em Utility to stringify a float. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_melexis_test_8ino_a9ca1a07ce803c9b09a05b991f0101107}{print\+C\+RC}} (uint8\+\_\+t crc, uint8\+\_\+t pec)
\begin{DoxyCompactList}\small\item\em Just print the crc and pec. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_melexis_test_8ino_a47075beca8233f9f8e9614f4fb6eabd1}{print\+Err\+Str}} (uint8\+\_\+t err)
\begin{DoxyCompactList}\small\item\em Convert error flags to diagnostic strings and print. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_melexis_test_8ino_a5662aecfa23cb7ad365b8246e928c843}{set\+E\+E\+Prom\+Defaults}} (void)
\begin{DoxyCompactList}\small\item\em Set E\+E\+P\+R\+OM memory contents to factory default values. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{_melexis_test_8ino_af12b22cf7e5666147279557c9b55db66}\label{_melexis_test_8ino_af12b22cf7e5666147279557c9b55db66}} 
\mbox{\hyperlink{class_m_l_x90614}{M\+L\+X90614}} {\bfseries mlx} = \mbox{\hyperlink{class_m_l_x90614}{M\+L\+X90614}}(M\+L\+X90614\+\_\+\+B\+R\+O\+A\+D\+C\+A\+S\+T\+A\+D\+DR)
\item 
const struct \mbox{\hyperlink{structdefault_e_e_prom_data}{default\+E\+E\+Prom\+Data}} {\bfseries e\+Dat} \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
Melexis M\+C\+X90614\+B\+AA Test Program -\/ Sensor test implementation. ~\newline
 

Arduino test implementation of Melexis M\+C\+X90614 P\+IR temperature sensor driver.

\begin{DoxyNote}{Note}
T\+H\+IS IS O\+N\+LY A P\+A\+R\+T\+I\+AL R\+E\+L\+E\+A\+SE. T\+H\+IS D\+E\+V\+I\+CE C\+L\+A\+SS IS C\+U\+R\+R\+E\+N\+T\+LY U\+N\+D\+E\+R\+G\+O\+I\+NG A\+C\+T\+I\+VE D\+E\+V\+E\+L\+O\+P\+M\+E\+NT A\+ND IS S\+T\+I\+LL M\+I\+S\+S\+I\+NG S\+O\+ME I\+M\+P\+O\+R\+T\+A\+NT F\+E\+A\+T\+U\+R\+ES. P\+L\+E\+A\+SE K\+E\+EP T\+H\+IS IN M\+I\+ND IF Y\+OU D\+E\+C\+I\+DE TO U\+SE T\+H\+IS P\+A\+R\+T\+I\+C\+U\+L\+AR C\+O\+DE F\+OR A\+N\+Y\+T\+H\+I\+NG.
\end{DoxyNote}
~\newline
\begin{DoxyAuthor}{Author}
J. F. Fitter \href{mailto:jfitter@eagleairaust.com.au}{\tt jfitter@eagleairaust.\+com.\+au} ~\newline

\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0 ~\newline

\end{DoxyVersion}
\begin{DoxyDate}{Date}
2014-\/2017 ~\newline

\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2017 John Fitter. All right reserved.
\end{DoxyCopyright}
\begin{DoxyParagraph}{License}
This program is free software; you can redistribute it and/or modify it under the terms of the G\+NU Lesser General Public License as published by the Free Software Foundation; either version 2.\+1 of the License, or (at your option) any later version. 
\end{DoxyParagraph}
\begin{DoxyParagraph}{}
This Program is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+UT A\+NY W\+A\+R\+R\+A\+N\+TY; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY or F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE. See the G\+NU Lesser General Public License for more details at \href{http://www.gnu.org/copyleft/gpl.html}{\tt http\+://www.\+gnu.\+org/copyleft/gpl.\+html} 
\end{DoxyParagraph}
\begin{DoxyParagraph}{}
You should have received a copy of the G\+NU Lesser General Public License along with this library; if not, write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-\/1301 U\+SA 
\end{DoxyParagraph}


Definition in file \mbox{\hyperlink{_melexis_test_8ino_source}{Melexis\+Test.\+ino}}.



\subsubsection{Function Documentation}
\mbox{\Hypertarget{_melexis_test_8ino_abbd67db9a56c14f56c98c750daf1ab92}\label{_melexis_test_8ino_abbd67db9a56c14f56c98c750daf1ab92}} 
\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}!float\+To\+Str@{float\+To\+Str}}
\index{float\+To\+Str@{float\+To\+Str}!Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}
\paragraph{\texorpdfstring{float\+To\+Str()}{floatToStr()}}
{\footnotesize\ttfamily char$\ast$ float\+To\+Str (\begin{DoxyParamCaption}\item[{char $\ast$}]{str,  }\item[{double}]{val }\end{DoxyParamCaption})}



Utility to stringify a float. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em str} & String to receive converted result \\
\hline
\mbox{\tt in}  & {\em val} & Float value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Float as string 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{_melexis_test_8ino_source_l00128}{128}} of file \mbox{\hyperlink{_melexis_test_8ino_source}{Melexis\+Test.\+ino}}.


\begin{DoxyCode}
00128                                         \{
00129 
00130     sprintf(str, \textcolor{stringliteral}{"%4d.%02u"}, \textcolor{keywordtype}{int}(val), \textcolor{keywordtype}{int}(val * 100) % 100);
00131     \textcolor{keywordflow}{return} str;
00132 \}
\end{DoxyCode}
\mbox{\Hypertarget{_melexis_test_8ino_a9ca1a07ce803c9b09a05b991f0101107}\label{_melexis_test_8ino_a9ca1a07ce803c9b09a05b991f0101107}} 
\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}!print\+C\+RC@{print\+C\+RC}}
\index{print\+C\+RC@{print\+C\+RC}!Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}
\paragraph{\texorpdfstring{print\+C\+R\+C()}{printCRC()}}
{\footnotesize\ttfamily void print\+C\+RC (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{crc,  }\item[{uint8\+\_\+t}]{pec }\end{DoxyParamCaption})}



Just print the crc and pec. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em crc} & C\+RC \\
\hline
\mbox{\tt in}  & {\em pec} & P\+EC \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_melexis_test_8ino_source_l00139}{139}} of file \mbox{\hyperlink{_melexis_test_8ino_source}{Melexis\+Test.\+ino}}.


\begin{DoxyCode}
00139 \{printf(\textcolor{stringliteral}{"crc=%02Xh pec=%02Xh"}, crc, pec);\}
\end{DoxyCode}
\mbox{\Hypertarget{_melexis_test_8ino_a47075beca8233f9f8e9614f4fb6eabd1}\label{_melexis_test_8ino_a47075beca8233f9f8e9614f4fb6eabd1}} 
\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}!print\+Err\+Str@{print\+Err\+Str}}
\index{print\+Err\+Str@{print\+Err\+Str}!Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}
\paragraph{\texorpdfstring{print\+Err\+Str()}{printErrStr()}}
{\footnotesize\ttfamily void print\+Err\+Str (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{err }\end{DoxyParamCaption})}



Convert error flags to diagnostic strings and print. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em err} & Error flags \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_melexis_test_8ino_source_l00145}{145}} of file \mbox{\hyperlink{_melexis_test_8ino_source}{Melexis\+Test.\+ino}}.


\begin{DoxyCode}
00145                               \{
00146 
00147     Serial.print(F(\textcolor{stringliteral}{"  *** "}));
00148     \textcolor{keywordflow}{if}(err == MLX90614\_NORWERROR) Serial.print(F(\textcolor{stringliteral}{"RW Success"}));
00149     \textcolor{keywordflow}{else} \{
00150         Serial.print(F(\textcolor{stringliteral}{"Errors: "}));
00151         \textcolor{keywordflow}{if}(err &  MLX90614\_DATATOOLONG) Serial.print(F(\textcolor{stringliteral}{"Data too long / "}));
00152         \textcolor{keywordflow}{if}(err &  MLX90614\_TXADDRNACK)  Serial.print(F(\textcolor{stringliteral}{"TX addr NACK / "}));
00153         \textcolor{keywordflow}{if}(err &  MLX90614\_TXDATANACK)  Serial.print(F(\textcolor{stringliteral}{"TX data NACK / "}));
00154         \textcolor{keywordflow}{if}(err &  MLX90614\_TXOTHER)     Serial.print(F(\textcolor{stringliteral}{"Unknown / "}));
00155         \textcolor{keywordflow}{if}(err &  MLX90614\_RXCRC)       Serial.print(F(\textcolor{stringliteral}{"RX CRC / "}));
00156         \textcolor{keywordflow}{if}(err &  MLX90614\_INVALIDATA)  Serial.print(F(\textcolor{stringliteral}{"Invalid data / "}));
00157         \textcolor{keywordflow}{if}(err &  MLX90614\_EECORRUPT)   Serial.print(F(\textcolor{stringliteral}{"EEPROM / "}));
00158         \textcolor{keywordflow}{if}(err &  MLX90614\_RFLGERR)     Serial.print(F(\textcolor{stringliteral}{"RFlags / "}));
00159     \}
00160 \}
\end{DoxyCode}
\mbox{\Hypertarget{_melexis_test_8ino_a3906dd03c261bb9c83de87b9988e91ce}\label{_melexis_test_8ino_a3906dd03c261bb9c83de87b9988e91ce}} 
\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}!println\+Temp@{println\+Temp}}
\index{println\+Temp@{println\+Temp}!Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}
\paragraph{\texorpdfstring{println\+Temp()}{printlnTemp()}}
{\footnotesize\ttfamily void println\+Temp (\begin{DoxyParamCaption}\item[{double}]{temp,  }\item[{char}]{src }\end{DoxyParamCaption})}



Print a line of temperature, crc, pec, and error string. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em temp} & Temperature \\
\hline
\mbox{\tt in}  & {\em src} & Temperature source \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{_melexis_test_8ino_source_l00092}{92}} of file \mbox{\hyperlink{_melexis_test_8ino_source}{Melexis\+Test.\+ino}}.



Referenced by \mbox{\hyperlink{_melexis_test_8ino_source_l00068}{loop()}}.


\begin{DoxyCode}
00092                                         \{
00093     \textcolor{keywordtype}{char} str[20];
00094 
00095     \textcolor{keywordflow}{if}(mlx.\mbox{\hyperlink{class_m_l_x90614_a13d10b57b4369c27e740585bf3907b0e}{rwError}}) Serial.print(F(\textcolor{stringliteral}{"No valid temperatures                              "}));
00096     \textcolor{keywordflow}{else} \{
00097         \textcolor{keywordflow}{if}(src == \textcolor{charliteral}{'A'}) Serial.print(F(\textcolor{stringliteral}{"Ambient temperature"}));
00098         \textcolor{keywordflow}{else} Serial.print(F(\textcolor{stringliteral}{"Object  temperature"}));
00099         printf(\textcolor{stringliteral}{" = %sK "}, \mbox{\hyperlink{_melexis_test_8ino_abbd67db9a56c14f56c98c750daf1ab92}{floatToStr}}(str, temp));
00100         printf(\textcolor{stringliteral}{"%sC "},    \mbox{\hyperlink{_melexis_test_8ino_abbd67db9a56c14f56c98c750daf1ab92}{floatToStr}}(str, mlx.\mbox{\hyperlink{class_m_l_x90614_af0a52019a3c66f0ae3b954a4e7475c88}{convKtoC}}(temp)));
00101         printf(\textcolor{stringliteral}{"%sF    "}, \mbox{\hyperlink{_melexis_test_8ino_abbd67db9a56c14f56c98c750daf1ab92}{floatToStr}}(str, mlx.\mbox{\hyperlink{class_m_l_x90614_a2a5b34da155086b85fb74ceb7310b2cb}{convCtoF}}(mlx.
      \mbox{\hyperlink{class_m_l_x90614_af0a52019a3c66f0ae3b954a4e7475c88}{convKtoC}}(temp))));
00102     \}
00103     \mbox{\hyperlink{_melexis_test_8ino_a9ca1a07ce803c9b09a05b991f0101107}{printCRC}}(mlx.\mbox{\hyperlink{class_m_l_x90614_aa13abb960da5f7d8d0eb26df8632a679}{crc8}}, mlx.\mbox{\hyperlink{class_m_l_x90614_af050e02eecd12a127a98fb2b30e40a88}{pec}});
00104     \mbox{\hyperlink{_melexis_test_8ino_a47075beca8233f9f8e9614f4fb6eabd1}{printErrStr}}(mlx.\mbox{\hyperlink{class_m_l_x90614_a13d10b57b4369c27e740585bf3907b0e}{rwError}});
00105     Serial.println(\textcolor{stringliteral}{""});
00106 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=218pt]{_melexis_test_8ino_a3906dd03c261bb9c83de87b9988e91ce_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{_melexis_test_8ino_a5662aecfa23cb7ad365b8246e928c843}\label{_melexis_test_8ino_a5662aecfa23cb7ad365b8246e928c843}} 
\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}!set\+E\+E\+Prom\+Defaults@{set\+E\+E\+Prom\+Defaults}}
\index{set\+E\+E\+Prom\+Defaults@{set\+E\+E\+Prom\+Defaults}!Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}
\paragraph{\texorpdfstring{set\+E\+E\+Prom\+Defaults()}{setEEPromDefaults()}}
{\footnotesize\ttfamily void set\+E\+E\+Prom\+Defaults (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Set E\+E\+P\+R\+OM memory contents to factory default values. 

\begin{DoxyRemark}{Remarks}
A device with default adress must not be on the bus. ~\newline
{\ttfamily Only user allowed memory locations are written.} 
\end{DoxyRemark}


Definition at line \mbox{\hyperlink{_melexis_test_8ino_source_l00177}{177}} of file \mbox{\hyperlink{_melexis_test_8ino_source}{Melexis\+Test.\+ino}}.


\begin{DoxyCode}
00177                              \{
00178 
00179     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < \textcolor{keyword}{sizeof}(eDat)/\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structdefault_e_e_prom_data}{defaultEEPromData}}),
00180         !mlx.\mbox{\hyperlink{class_m_l_x90614_a13d10b57b4369c27e740585bf3907b0e}{rwError}}; i++) \{ 
00181         mlx.\mbox{\hyperlink{class_m_l_x90614_a70b3e428c623b6af5bedf199f5c16490}{writeEEProm}}(eDat[i].address, eDat[i].data);
00182     \}
00183 \}
\end{DoxyCode}


\subsubsection{Variable Documentation}
\mbox{\Hypertarget{_melexis_test_8ino_aa749b7d2a476c21158b27ed53cdcbc49}\label{_melexis_test_8ino_aa749b7d2a476c21158b27ed53cdcbc49}} 
\index{Melexis\+Test.\+ino@{Melexis\+Test.\+ino}!e\+Dat@{e\+Dat}}
\index{e\+Dat@{e\+Dat}!Melexis\+Test.\+ino@{Melexis\+Test.\+ino}}
\paragraph{\texorpdfstring{e\+Dat}{eDat}}
{\footnotesize\ttfamily const struct \mbox{\hyperlink{structdefault_e_e_prom_data}{default\+E\+E\+Prom\+Data}}  e\+Dat\mbox{[}$\,$\mbox{]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=  \{\{0x20, 0x9993\}, \{0x21, 0x62E3\}, \{0x22, 0x0201\}, 
             \{0x23, 0xF71C\}, \{0x24, 0xFFFF\}, \{0x25, 0x9FB4\}, 
             \{0x2E, 0xBE5A\}, \{0x2F, 0x0000\}, \{0x39, 0x0000\}\}
\end{DoxyCode}
